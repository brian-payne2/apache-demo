---
- name: Install and configure Apache
  hosts: 3.84.28.166
  remote_user: ec2-user
  become: yes
  become_method: sudo

  tasks:
  - name: Install dependencies
    yum:
      name: ['openssh', 'httpd', 'mod_ssl']
      state: present

  - name: Insert Index Page
    template:
      src: index.html
      dest: /var/www/html/index.html

  - name: Insert httpd.conf
    template:
      src: httpd.conf
      dest: /etc/httpd/conf/httpd.conf

  - name: Insert public key
    copy:
      src: "public.crt"
      dest: "/etc/pki/tls/certs/localhost.crt"
      owner: root
      group: root
      mode: 0644

  - name: Insert private key
    copy:
      src: "private.key"
      dest: "/etc/pki/tls/private/localhost.key"
      owner: root
      group: root
      mode: 0400

  - name: Restart httpd
    service:
      name: httpd
      state: reloaded
